- name: "Check if mirrorlist exceeds age criteria"
  ansible.builtin.find:
    paths: "{{ repo_servers_file_path | dirname }}"
    patterns: >-
      ^{{ repo_servers_file_path | basename }}$
    use_regex: yes
    age: "{{ update_age_cutoff }}"
  register: mirrors_found
  changed_when: mirrors_found.matched > 0

- name: "Update Arch Linux mirrorlist"
  ansible.builtin.include_tasks: archlinux/do_archlinux_update.yml
  vars:
    mirrors_file: "{{ repo_servers_file_path }}"
    mirrors_bkup: "{{ repo_servers_file_path | dirname }}/{{ repo_servers_bkup_filename }}"
  when: mirrors_found.changed

